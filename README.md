# Cobol Static Program Analyzer
In Corporate IT world there are still many Cobol programs running. \
One of the biggest challenges is to understand how these programs work and which is the logic and the business rules which are implemented in them. \
I want to create a tool that leverages the power of static code analysis and LLMs ability to summarize and explain code to generate clear, coincise and structured documentation of the business logic and business rules implemented in Cobol programs.

## Core ideas on how to achieve this
- Cobol programs are usually structured using paragraphs and sections. Paragraphs and sections are sort of functions that are called from other parts of the same program using the `PERFORM` statement. \
This means that we can use the structure of the program to create a tree of paragraphs and sections. We can then use an LLM to summarize each paragraph and section which is a leaf of the tree. \
Then we can use the summaries of the leafs to summarize the parent nodes. This way we can create a tree of summaries that represents the structure of the program and the business logic implemented in it.
- Sometimes in a Cobol source code we find the `COPY` statement which is used to include other source code files. \
The `COPY` statement can be used in the `PROCEDURE DIVISION` to include other source code files that contain paragraphs and sections. Before starting the analysis we need to resolve all the `COPY` statements and include the source code of the included files in the analysis. \
 
## Architecture
- The tool will be a command line tool that takes a Cobol source code file as input and generates documentation files as output.
- The tool should be implemented either in Python or in Typescript. The choice depends of the libraries available to parse Cobol source to an abstract syntax tree (AST).
- The tool will use an LLM to summarize each paragraph and section
- The tool will first generate the summary of each paragraph or section which does not call other paragraphs or sections using the `PERFORM` statement (these are the leaves of the tree). \
Then it will generate the summary of each paragraph or section that calls other paragraphs or sections using the `PERFORM` statement, passing to the LLM the code of the section or paragraph and the summaries of the called paragraphs and sections.
### Strategies to generate the documentation
The tool will use two different strategies to generate the documentation:
1. **Parsing with AST**: The tool will parse the Cobol source code to generate an abstract syntax tree (AST) that represents the structure of the program. It will then traverse the AST to generate a tree of paragraphs and sections, and use the AST tree related to each section or paragraph to generate the summary. \
If a section or paragraph calls other sections or paragraphs using the `PERFORM` statement, the tool will include the summaries of the called sections and paragraphs in the code passed to the LLM to generate the summary of the section or paragraph.
2. **Parsing line by line**: The tool will read the Cobol source code line by line to generate a tree of paragraphs and sections directly from the source code. It will then use the code of each section or paragraph to generate the summary. \
If a section or paragraph calls other sections or paragraphs using the `PERFORM` statement, the tool will include the summaries of the called sections and paragraphs in the code passed to the LLM to generate the summary of the section or paragraph. 

## Output produced
The tool will generate a json file as output to represent the tree of paragraphs and sections of the program. Each paragraph or section will have the following information:
- the name of the section or paragraph with the name of the file where it is present (the main file or an included file).
- the code of the section or paragraph.
- the summary of the section or paragraph generated by the LLM using the AST approach
- the summary of the section or paragraph generated by the LLM using the line by line approach
- the list of paragraphs and sections that called in the code of the section or paragraph using the `PERFORM` statement.

